<div class="dashboard-container">
  <!-- å¤´éƒ¨ -->
  <div class="dashboard-header">
    <div class="container">
      <h1>ğŸ“Š æ•°æ®ç»Ÿè®¡</h1>
      <p class="subtitle">åšå®¢ç³»ç»Ÿæ•°æ®æ€»è§ˆ</p>
    </div>
  </div>

  <div class="container">
    @if (isLoading()) {
      <div class="loading">
        <div class="spinner"></div>
        <p>åŠ è½½ä¸­...</p>
      </div>
    } @else {
      <!-- ç»Ÿè®¡å¡ç‰‡ -->
      <div class="stats-grid">
        @for (stat of stats(); track stat.title) {
          <div class="stat-card" [style.border-left-color]="stat.color">
            <div class="stat-icon" [style.background-color]="stat.color + '20'">
              {{ stat.icon }}
            </div>
            <div class="stat-content">
              <h3 class="stat-title">{{ stat.title }}</h3>
              <div class="stat-value">{{ formatNumber(stat.value) }}</div>
              <div class="stat-change" [class.positive]="stat.trend === 'up'" [class.negative]="stat.trend === 'down'">
                <span class="arrow">{{ stat.trend === 'up' ? 'â†‘' : 'â†“' }}</span>
                {{ stat.change }}% è¾ƒä¸Šæœˆ
              </div>
            </div>
          </div>
        }
      </div>

      <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
      <div class="dashboard-content">
        <!-- å·¦ä¾§åˆ— -->
        <div class="content-left">
          <!-- æœˆåº¦å‘å¸ƒè¶‹åŠ¿ -->
          <div class="dashboard-card">
            <div class="card-header">
              <h2>ğŸ“ˆ æœˆåº¦å‘å¸ƒè¶‹åŠ¿</h2>
            </div>
            <div class="card-body">
              <!-- æ—¥æœŸèŒƒå›´é€‰æ‹©å™¨ -->
              <div class="date-range-selector">
                <mat-form-field appearance="outline" class="date-field">
                  <mat-label>å¼€å§‹æ—¥æœŸ</mat-label>
                  <input
                    matInput
                    [matDatepicker]="startPicker"
                    [value]="startDate()"
                    (dateChange)="onStartDateChange($event.value)"
                    placeholder="é€‰æ‹©å¼€å§‹æ—¥æœŸ">
                  <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
                  <mat-datepicker #startPicker></mat-datepicker>
                </mat-form-field>

                <span class="date-separator">è‡³</span>

                <mat-form-field appearance="outline" class="date-field">
                  <mat-label>ç»“æŸæ—¥æœŸ</mat-label>
                  <input
                    matInput
                    [matDatepicker]="endPicker"
                    [value]="endDate()"
                    (dateChange)="onEndDateChange($event.value)"
                    placeholder="é€‰æ‹©ç»“æŸæ—¥æœŸ">
                  <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
                  <mat-datepicker #endPicker></mat-datepicker>
                </mat-form-field>

                <button mat-raised-button color="primary" (click)="resetDateRange()" class="reset-button">
                  é‡ç½®
                </button>
              </div>

              <!-- ECharts æ›²çº¿å›¾ -->
              <div class="chart-container">
                <div echarts [options]="chartOption()" class="echarts-chart"></div>
              </div>
            </div>
          </div>

          <!-- åˆ†ç±»ç»Ÿè®¡ -->
          <div class="dashboard-card">
            <div class="card-header">
              <h2>ğŸ“‚ åˆ†ç±»ç»Ÿè®¡</h2>
            </div>
            <div class="card-body">
              <div class="category-stats">
                @for (cat of categoryStats(); track cat.label) {
                  <div class="category-item">
                    <div class="category-info">
                      <span class="category-label">{{ cat.label }}</span>
                      <span class="category-count">{{ cat.value }} ç¯‡ ({{ cat.percentage }}%)</span>
                    </div>
                    <div class="progress-bar">
                      <div
                        class="progress-fill"
                        [style.width.%]="cat.percentage">
                      </div>
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>

          <!-- çƒ­é—¨æ ‡ç­¾ -->
          <div class="dashboard-card">
            <div class="card-header">
              <h2>ğŸ·ï¸ çƒ­é—¨æ ‡ç­¾</h2>
            </div>
            <div class="card-body">
              <div class="tag-cloud-stats">
                @for (tag of tagStats(); track tag.label) {
                  <div class="tag-stat-item">
                    <span class="tag-name">#{{ tag.label }}</span>
                    <span class="tag-count">{{ tag.value }}</span>
                  </div>
                }
              </div>
            </div>
          </div>
        </div>

        <!-- å³ä¾§åˆ— -->
        <div class="content-right">
          <!-- å‘å¸ƒçŠ¶æ€ -->
          <div class="dashboard-card">
            <div class="card-header">
              <h2>ğŸ“‹ å‘å¸ƒçŠ¶æ€</h2>
            </div>
            <div class="card-body">
              <div class="publish-stats">
                @for (stat of publishStats(); track stat.label) {
                  <div class="publish-item">
                    <div class="publish-info">
                      <div
                        class="publish-indicator"
                        [class.published]="stat.label === 'å·²å‘å¸ƒ'"
                        [class.draft]="stat.label === 'è‰ç¨¿'">
                      </div>
                      <span class="publish-label">{{ stat.label }}</span>
                    </div>
                    <div class="publish-value">
                      <span class="value">{{ stat.value }}</span>
                      <span class="percentage">{{ stat.percentage }}%</span>
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>

          <!-- çƒ­é—¨æ–‡ç«  -->
          <div class="dashboard-card">
            <div class="card-header">
              <h2>ğŸ”¥ çƒ­é—¨æ–‡ç« </h2>
            </div>
            <div class="card-body">
              <div class="blog-list">
                @for (blog of popularBlogs(); track blog.id; let i = $index) {
                  <div class="blog-item" [routerLink]="['/blog', blog.id]">
                    <div class="blog-rank">{{ i + 1 }}</div>
                    <div class="blog-info">
                      <h4 class="blog-title">{{ blog.title }}</h4>
                      <div class="blog-meta">
                        <span>ğŸ‘ï¸ {{ blog.viewCount }}</span>
                        <span>â¤ï¸ {{ blog.likeCount }}</span>
                        <span>ğŸ’¬ {{ blog.commentCount }}</span>
                      </div>
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>

          <!-- æœ€æ–°æ–‡ç«  -->
          <div class="dashboard-card">
            <div class="card-header">
              <h2>ğŸ“ æœ€æ–°æ–‡ç« </h2>
            </div>
            <div class="card-body">
              <div class="blog-list">
                @for (blog of recentBlogs(); track blog.id) {
                  <div class="blog-item" [routerLink]="['/blog', blog.id]">
                    <div class="blog-date">
                      {{ blog.publishedAt | dateFormat:'short' }}
                    </div>
                    <div class="blog-info">
                      <h4 class="blog-title">{{ blog.title }}</h4>
                      <div class="blog-category">
                        <span class="category-badge">{{ blog.category.name }}</span>
                      </div>
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</div>
