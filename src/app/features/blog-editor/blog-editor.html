<div class="editor-container">
  <!-- å·¥å…·æ  -->
  <div class="toolbar">
    <div class="toolbar-left">
      <button (click)="insertMarkdown('bold')" title="ç²—ä½“">
        <i class="icon-bold">B</i>
      </button>
      <button (click)="insertMarkdown('italic')" title="æ–œä½“">
        <i class="icon-italic">I</i>
      </button>
      <button (click)="insertMarkdown('heading')" title="æ ‡é¢˜">
        H
      </button>
      <button (click)="insertMarkdown('link')" title="é“¾æ¥">
        ğŸ”—
      </button>
      <button (click)="insertMarkdown('image')" title="å›¾ç‰‡">
        ğŸ–¼ï¸
      </button>
      <button (click)="insertMarkdown('code')" title="ä»£ç ">
        &lt;/&gt;
      </button>
      <button (click)="insertMarkdown('code-block')" title="ä»£ç å—">
        ğŸ“
      </button>
      <button (click)="insertMarkdown('quote')" title="å¼•ç”¨">
        "
      </button>
      <button (click)="insertMarkdown('list')" title="åˆ—è¡¨">
        â‰¡
      </button>
      
      <label class="upload-btn" [class.uploading]="isUploadingImage()">
        @if (isUploadingImage()) {
          <span class="spinner"></span>
          ä¸Šä¼ ä¸­... {{ uploadProgress() }}%
        } @else {
          ğŸ“¤ ä¸Šä¼ å›¾ç‰‡
        }
        <input
          type="file"
          accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
          (change)="uploadImage($event)"
          [disabled]="isUploadingImage()"
          hidden>
      </label>
    </div>
    
    <div class="toolbar-right">
      <button (click)="togglePreview()" [class.active]="previewMode()">
        {{ previewMode() ? 'âœï¸ ç¼–è¾‘' : 'ğŸ‘ï¸ é¢„è§ˆ' }}
      </button>
    </div>
  </div>
  
  <!-- ç¼–è¾‘å™¨ä¸»ä½“ -->
  <div class="editor-body">
    <!-- å·¦ä¾§ï¼šè¡¨å• -->
    <div class="editor-form" [class.hidden]="previewMode()">
      <form [formGroup]="blogForm">
        <!-- æ ‡é¢˜ -->
        <div class="form-group">
          <label>æ ‡é¢˜ *</label>
          <input 
            type="text" 
            formControlName="title" 
            placeholder="è¾“å…¥åšå®¢æ ‡é¢˜"
            class="form-control">
          @if (blogForm.get('title')?.invalid && blogForm.get('title')?.touched) {
            <span class="error">æ ‡é¢˜ä¸ºå¿…å¡«é¡¹ï¼Œè‡³å°‘3ä¸ªå­—ç¬¦</span>
          }
        </div>
        
        <!-- Markdownå†…å®¹ -->
        <div class="form-group">
          <label>å†…å®¹ *</label>
          <textarea 
            formControlName="content"
            placeholder="ä½¿ç”¨ Markdown ç¼–å†™å†…å®¹..."
            rows="20"
            class="form-control markdown-editor"></textarea>
          @if (blogForm.get('content')?.invalid && blogForm.get('content')?.touched) {
            <span class="error">å†…å®¹ä¸èƒ½ä¸ºç©º</span>
          }
        </div>
        
        <!-- æ‘˜è¦ -->
        <div class="form-group">
          <label>
            æ‘˜è¦ *
            <button type="button" (click)="generateExcerpt()" class="btn-link">
              è‡ªåŠ¨ç”Ÿæˆ
            </button>
          </label>
          <textarea 
            formControlName="excerpt"
            placeholder="åšå®¢æ‘˜è¦ï¼Œæœ€å¤š200å­—"
            rows="3"
            maxlength="200"
            class="form-control"></textarea>
          <small>{{ blogForm.get('excerpt')?.value?.length || 0 }} / 200</small>
        </div>
        
        <!-- å°é¢å›¾ç‰‡ -->
        <div class="form-group">
          <label>å°é¢å›¾ç‰‡ URL</label>
          <input 
            type="text" 
            formControlName="coverImage"
            placeholder="https://example.com/image.jpg"
            class="form-control">
        </div>
        
        <!-- åˆ†ç±» -->
        <div class="form-group">
          <label>åˆ†ç±» *</label>
          <select formControlName="categoryId" class="form-control">
            <option value="">é€‰æ‹©åˆ†ç±»</option>
            @for (category of categories(); track category.id) {
              <option [value]="category.id">{{ category.name }}</option>
            }
          </select>
        </div>
        
        <!-- æ ‡ç­¾ -->
        <div class="form-group">
          <label>æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
          <input 
            type="text" 
            formControlName="tags"
            placeholder="Angular, TypeScript, Webå¼€å‘"
            class="form-control">
        </div>
        
        <!-- SEOè®¾ç½® -->
        <div class="seo-section">
          <h3>SEO ä¼˜åŒ–è®¾ç½®</h3>
          
          <div class="form-group">
            <label>SEOæ ‡é¢˜</label>
            <input 
              type="text" 
              formControlName="metaTitle"
              placeholder="ç•™ç©ºåˆ™ä½¿ç”¨æ–‡ç« æ ‡é¢˜"
              class="form-control">
          </div>
          
          <div class="form-group">
            <label>SEOæè¿°</label>
            <textarea 
              formControlName="metaDescription"
              placeholder="ç•™ç©ºåˆ™ä½¿ç”¨æ–‡ç« æ‘˜è¦"
              rows="2"
              class="form-control"></textarea>
          </div>
          
          <div class="form-group">
            <label>å…³é”®è¯ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
            <input 
              type="text" 
              formControlName="metaKeywords"
              placeholder="å…³é”®è¯1, å…³é”®è¯2"
              class="form-control">
          </div>
        </div>
      </form>
    </div>
    
    <!-- å³ä¾§ï¼šé¢„è§ˆ -->
    <div class="editor-preview" [class.fullwidth]="previewMode()">
      <div class="preview-header">
        <h1>{{ blogForm.get('title')?.value || 'é¢„è§ˆæ ‡é¢˜' }}</h1>
        @if (blogForm.get('excerpt')?.value) {
          <p class="excerpt">{{ blogForm.get('excerpt')?.value }}</p>
        }
      </div>
      
      <div class="preview-content">
        <markdown 
          [data]="markdownContent()"
          class="markdown-body">
        </markdown>
      </div>
    </div>
  </div>
  
  <!-- åº•éƒ¨æ“ä½œæ  -->
  <div class="editor-footer">
    <button 
      type="button" 
      (click)="saveDraft()"
      [disabled]="isSaving()"
      class="btn btn-secondary">
      {{ isSaving() ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜è‰ç¨¿' }}
    </button>
    
    <button 
      type="button"
      (click)="publishBlog()"
      [disabled]="isSaving() || blogForm.invalid"
      class="btn btn-primary">
      {{ isSaving() ? 'å‘å¸ƒä¸­...' : isEditMode() ? 'æ›´æ–°åšå®¢' : 'å‘å¸ƒåšå®¢' }}
    </button>
  </div>
</div>