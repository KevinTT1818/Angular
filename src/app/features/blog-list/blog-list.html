<div class="blog-list-container">
  <!-- å¤´éƒ¨æœç´¢åŒº -->
  <div class="blog-header">
    <div class="container">
      <div class="header-top">
        <div class="header-text">
          <h1>æŠ€æœ¯åšå®¢</h1>
          <p class="subtitle">åˆ†äº«ç¼–ç¨‹çŸ¥è¯†ä¸å¼€å‘ç»éªŒ</p>
        </div>
      </div>

      <!-- æœç´¢å’Œç­›é€‰åŒºåŸŸ -->
      <div class="search-filter-wrapper">
        <!-- æœç´¢æ¡† -->
        <div class="search-section">
          <app-search-bar
            [placeholder]="'æœç´¢åšå®¢æ ‡é¢˜ã€å†…å®¹...'"
            [initialValue]="searchQuery()"
            (search)="onSearch($event)"
            (clear)="onClearSearch()">
          </app-search-bar>
        </div>

        <!-- å¿«æ·ç­›é€‰æ  -->
        <div class="quick-filters">
          <!-- æ’åºé€‰æ‹© -->
          <div class="filter-group">
            <label class="filter-label">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                <path d="M7 2v10M7 12l-3-3M7 12l3-3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              æ’åº
            </label>
            <select class="filter-select" [value]="sortBy()" (change)="onSortChange($event)">
              <option value="latest">æœ€æ–°å‘å¸ƒ</option>
              <option value="popular">æœ€çƒ­é—¨</option>
              <option value="title">æ ‡é¢˜ A-Z</option>
            </select>
          </div>

          <!-- åˆ†ç±»é€‰æ‹© -->
          <div class="filter-group">
            <label class="filter-label">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                <path d="M2 2h4v4H2V2zM8 2h4v4H8V2zM2 8h4v4H2V8z" stroke="currentColor" stroke-width="1.5"/>
              </svg>
              åˆ†ç±»
            </label>
            <select class="filter-select" [value]="selectedCategory() || ''" (change)="onCategoryChange($event)">
              <option value="">å…¨éƒ¨åˆ†ç±»</option>
              @for (category of categories(); track category.id) {
                <option [value]="category.id">{{ category.name }}</option>
              }
            </select>
          </div>

          <!-- æ›´å¤šç­›é€‰æŒ‰é’® -->
          <button class="more-filters-btn" (click)="toggleAdvancedFilters()" type="button">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M2 4h12M5 8h6M7 12h2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            æ›´å¤šç­›é€‰
            @if (selectedTags().length > 0) {
              <span class="filter-count">{{ selectedTags().length }}</span>
            }
          </button>

          <!-- æ¸…é™¤ç­›é€‰ -->
          @if (hasActiveFilters()) {
            <button class="clear-filters-btn" (click)="clearFilters()" type="button">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                <path d="M10 4L4 10M4 4l6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              æ¸…é™¤
            </button>
          }
        </div>

        <!-- é«˜çº§ç­›é€‰é¢æ¿ -->
        @if (showAdvancedFilters()) {
          <div class="advanced-filters">
            <div class="advanced-filters-header">
              <h3>æ ‡ç­¾ç­›é€‰</h3>
              <button class="close-btn" (click)="toggleAdvancedFilters()" type="button">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M12 4L4 12M4 4l8 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </button>
            </div>
            <div class="tags-filter">
              @for (tag of availableTags(); track tag) {
                <button
                  class="tag-chip"
                  [class.active]="selectedTags().includes(tag)"
                  (click)="selectTag(tag)"
                  type="button">
                  #{{ tag }}
                  @if (selectedTags().includes(tag)) {
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                      <path d="M9 3L5 7l-2-2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                  }
                </button>
              }
            </div>
          </div>
        }
      </div>
    </div>
  </div>
  
  <div class="container main-content">
    <div class="content-wrapper">
      <!-- å·¦ä¾§ï¼šåšå®¢åˆ—è¡¨ -->
      <div class="blog-list-section">
        <!-- ç­›é€‰æ¡ä»¶æ˜¾ç¤º -->
        @if (hasActiveFilters()) {
          <div class="filter-badge">
            <span>å½“å‰ç­›é€‰ï¼š</span>
            @if (searchQuery()) {
              <span class="badge">
                æœç´¢: {{ searchQuery() }}
                <button (click)="onClearSearch()">âœ•</button>
              </span>
            }
            @if (selectedCategory()) {
              <span class="badge">
                {{ getCategoryName(selectedCategory()!) }}
                <button (click)="selectCategory(undefined)">âœ•</button>
              </span>
            }
            @for (tag of selectedTags(); track tag) {
              <span class="badge">
                #{{ tag }}
                <button (click)="selectTag(tag)">âœ•</button>
              </span>
            }
            @if (sortBy() !== 'latest') {
              <span class="badge">
                æ’åº: {{ sortBy() === 'popular' ? 'æœ€çƒ­' : 'æ ‡é¢˜' }}
                <button (click)="sortBy.set('latest'); updateUrlParams()">âœ•</button>
              </span>
            }
            <button (click)="clearFilters()" class="clear-all">æ¸…é™¤æ‰€æœ‰</button>
          </div>
        }
        
        <!-- åŠ è½½çŠ¶æ€ -->
        @if (isLoading()) {
          <div class="loading">
            <div class="spinner"></div>
            <p>åŠ è½½ä¸­...</p>
          </div>
        }
        
        <!-- åšå®¢å¡ç‰‡åˆ—è¡¨ -->
        @if (!isLoading() && hasBlogs()) {
          <div class="blog-cards">
            @for (blog of blogs(); track blog.id) {
              <article class="blog-card" (click)="viewBlog(blog.id)">
                <!-- å°é¢å›¾ -->
                @if (blog.coverImage) {
                  <div class="blog-cover">
                    <img
                      [src]="blog.coverImage"
                      [alt]="blog.title"
                      (error)="onImageError($event)"
                      loading="lazy">
                    @if (!blog.isPublished) {
                      <span class="draft-badge">è‰ç¨¿</span>
                    }
                  </div>
                }
                
                <div class="blog-content">
                  <!-- åˆ†ç±»æ ‡ç­¾ -->
                  <div class="blog-meta-top">
                    <span class="category-badge">
                      {{ blog.category.name }}
                    </span>
                    <span class="date">
                      {{ blog.publishedAt | dateFormat }}
                    </span>
                  </div>
                  
                  <!-- æ ‡é¢˜ -->
                  <h2 class="blog-title">{{ blog.title }}</h2>
                  
                  <!-- æ‘˜è¦ -->
                  <p class="blog-excerpt">
                    {{ blog.excerpt | excerpt:150 }}
                  </p>
                  
                  <!-- æ ‡ç­¾ -->
                  <div class="blog-tags">
                    @for (tag of blog.tags; track tag) {
                      <span
                        class="tag"
                        [class.active]="selectedTags().includes(tag)"
                        (click)="selectTag(tag); $event.stopPropagation()">
                        #{{ tag }}
                      </span>
                    }
                  </div>
                  
                  <!-- åº•éƒ¨å…ƒä¿¡æ¯ -->
                  <div class="blog-meta-bottom">
                    <div class="author-info">
                      @if (blog.authorAvatar) {
                        <img [src]="blog.authorAvatar" [alt]="blog.author" class="avatar">
                      }
                      <span>{{ blog.author }}</span>
                    </div>
                    
                    <div class="blog-stats">
                      <span title="æµè§ˆé‡">
                        ğŸ‘ï¸ {{ blog.viewCount }}
                      </span>
                      <span title="ç‚¹èµæ•°">
                        â¤ï¸ {{ blog.likeCount }}
                      </span>
                      <span title="è¯„è®ºæ•°">
                        ğŸ’¬ {{ blog.commentCount }}
                      </span>
                    </div>
                  </div>
                </div>
              </article>
            }
          </div>
          
          <!-- åˆ†é¡µ -->
          @if (totalPages() > 1) {
            <div class="pagination">
              <button 
                (click)="goToPage(currentPage() - 1)"
                [disabled]="currentPage() === 1"
                class="page-btn">
                â† ä¸Šä¸€é¡µ
              </button>
              
              @if (pages()[0] > 1) {
                <button (click)="goToPage(1)" class="page-number">1</button>
                @if (pages()[0] > 2) {
                  <span class="ellipsis">...</span>
                }
              }
              
              @for (page of pages(); track page) {
                <button 
                  (click)="goToPage(page)"
                  [class.active]="page === currentPage()"
                  class="page-number">
                  {{ page }}
                </button>
              }
              
              @if (pages()[pages().length - 1] < totalPages()) {
                @if (pages()[pages().length - 1] < totalPages() - 1) {
                  <span class="ellipsis">...</span>
                }
                <button (click)="goToPage(totalPages())" class="page-number">
                  {{ totalPages() }}
                </button>
              }
              
              <button 
                (click)="goToPage(currentPage() + 1)"
                [disabled]="currentPage() === totalPages()"
                class="page-btn">
                ä¸‹ä¸€é¡µ â†’
              </button>
            </div>
          }
        }
        
        <!-- ç©ºçŠ¶æ€ -->
        @if (!isLoading() && !hasBlogs()) {
          <div class="empty-state">
            <div class="empty-icon">ğŸ“</div>
            <h3>æš‚æ— åšå®¢</h3>
            <p>è¿˜æ²¡æœ‰å‘å¸ƒä»»ä½•åšå®¢æ–‡ç« </p>
          </div>
        }
      </div>
      
      <!-- å³ä¾§ï¼šä¾§è¾¹æ  -->
      <aside class="sidebar">
        <!-- åˆ†ç±»åˆ—è¡¨ -->
        <div class="sidebar-card">
          <h3 class="sidebar-title">ğŸ“‚ åˆ†ç±»</h3>
          <ul class="category-list">
            <li
              (click)="selectCategory(undefined)"
              [class.active]="!selectedCategory()">
              <span>å…¨éƒ¨</span>
              <span class="count">{{ totalBlogs() }}</span>
            </li>
            @for (category of categories(); track category.id) {
              <li
                (click)="selectCategory(category.id)"
                [class.active]="selectedCategory() === category.id">
                <span>{{ category.name }}</span>
                <span class="count">{{ category.blogCount }}</span>
              </li>
            }
          </ul>
        </div>
        
        <!-- çƒ­é—¨æ–‡ç«  -->
        <div class="sidebar-card">
          <h3 class="sidebar-title">ğŸ”¥ çƒ­é—¨æ–‡ç« </h3>
          <ul class="popular-list">
            @for (blog of popularBlogs(); track blog.id; let i = $index) {
              <li (click)="viewBlog(blog.id)">
                <span class="rank">{{ i + 1 }}</span>
                <div class="popular-info">
                  <h4>{{ blog.title }}</h4>
                  <div class="popular-meta">
                    <span>ğŸ‘ï¸ {{ blog.viewCount }}</span>
                    <span>â¤ï¸ {{ blog.likeCount }}</span>
                  </div>
                </div>
              </li>
            }
          </ul>
        </div>
        
        <!-- æ ‡ç­¾äº‘ -->
        <div class="sidebar-card">
          <h3 class="sidebar-title">ğŸ·ï¸ æ ‡ç­¾äº‘</h3>
          <div class="tag-cloud">
            @for (tag of getAllTags(); track tag) {
              <span
                class="tag-item"
                (click)="selectTag(tag)"
                [class.active]="selectedTags().includes(tag)">
                {{ tag }}
              </span>
            }
          </div>
        </div>
      </aside>
    </div>
  </div>
</div>